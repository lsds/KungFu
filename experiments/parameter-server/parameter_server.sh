#!/bin/sh
set -e

# cd KungFu

run_experiment(){
local np=$1
shift
kungfu-prun \
-np ${np} -H  127.0.0.1:${np} \
-timeout 10000s \
$@
}


# 169.254.128.207:8,169.254.128.185:8 -nic ib0
# --ps_hosts=169.254.128.207:2220,169.254.128.207:2221,169.254.128.207:2222,169.254.128.207:2223,169.254.128.207:2224,169.254.128.207:2225,169.254.128.207:2226,169.254.128.207:2227 \
# --worker_hosts=169.254.128.185:2220,169.254.128.185:2221,169.254.128.185:2222,169.254.128.185:2223,169.254.128.185:2224,169.254.128.185:2225,169.254.128.185:2226,169.254.128.185:2227

export TF_CPP_MIN_LOG_LEVEL=1


# ResNet-50
run_experiment 2 python3 ps.py \
--model=ResNet50 \
--ps_hosts=127.0.0.1:2220,127.0.0.1:2221 \
--worker_hosts=127.0.0.1:2220,127.0.0.1:2221